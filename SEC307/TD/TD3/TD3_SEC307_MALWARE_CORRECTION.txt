

Machine infectee : IP : 192.168.1.42 MAC : 08:00:27:21:f6:82

pour connaitre le systeme d'exploitation, il faut regarder le contenus des requetes HTTP

User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)

pour regarder tous les protocoles utilisés, on regarde les statisques de protocoles avec Statistics/Protocol Hierarchy

pour regarder les adresses IP communiquées, on fait Statistics/Endpoints

pour regarder les differents domaines contactés, on fait endpoints apres avoir selectionne HTTP puis on recherche l'adresse 162.252.85.172 -> phproxy ip.addr==162.252.85.172 && http pour voir la traduction de l'hote cad phproxy

phproxy va transformer les requetes HTTPS en HTTP

tshark -r trace.cap -Y ip.addr==162.252.85.172 -T fields -e http.request.uri.query tshark -r trace.cap -Y "http.host==www.phproxysite.com" -T fields -e http.request.uri.query | cut -d '%' -f 4

tshark -r trace.cap -Y ip.addr==162.252.85.172 -T fields -e http.request.uri.query tshark -r trace.cap -Y "http.host==www.phproxysite.com" -T fields -e http.request.uri.query |cut -d '%' -f 4 tshark -r trace.cap -Y http -T fields -e http.host |sort |uniq -c |sort -n

tcpflow -r trace.cap -e http -o ./pages_web/ host 162.252.85.172 permet de telecharger les pages web que la victime a consulte en allant sur 162.252.85.172

tshark -r trace.cap -Y "http.host==www.phproxysite.com and http.request.method==POST" -T fields -e http.file_data

unzip flow_yandex/162.252.085.172.00080-192.168.001.042.50514-HTTPBODY-004.zip

upx -d *.exe

chercher BTRESULT malware sur Google

perdu.com est 192.168.1.45 tshark -r trace.cap -Y "ip.addr==192.168.1.45 && http" -T fields -e http.host -e http.request.uri -e http.content_type

js-beautify pour desobfusquer le JS

ndisasm shellcode : pour decoder la partie qui va decoder le shellcode
